# Create layer structure
mkdir -p python/lib/python3.14/site-packages

# Install psycopg2-binary
pip3 install psycopg2-binary -t python/lib/python3.14/site-packages/

# Create zip
zip -r psycopg2-layer.zip python

# Publish layer
aws lambda publish-layer-version \
  --layer-name psycopg2-py314-layer \
  --zip-file fileb://psycopg2-layer.zip \
  --compatible-runtimes python3.14 \
  --description "psycopg2 for Python 3.14"

# Note the LayerVersionArn from output, then attach to function
aws lambda update-function-configuration \
  --function-name priority-tasks-api \
  --layers arn:aws:lambda:REGION:ACCOUNT_ID:layer:psycopg2-py314-layer:1

# Cleanup
rm -rf python psycopg2-layer.zip
